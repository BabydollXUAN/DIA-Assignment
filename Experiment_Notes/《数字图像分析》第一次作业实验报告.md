
作业名称： 基于球面哈希的图像检索 

姓名： 赵煊

学号： SA25010114

提交日期： 2025年12月

---

## 1. 任务说明 (Task Description)

本实验旨在基于球面哈希（Spherical Hashing）算法实现高效的图像检索系统。实验使用 MIRFLICKR25K 图像数据集的子集，包含 16,000 张图像，每张图像由 768 维视觉特征向量表示 。

**主要任务包括：**

1. **模型训练：** 利用 15,000 张数据库图像训练球面哈希函数，将高维特征映射为二进制哈希码。
    
2. **多比特测试：** 分别测试 **32、64、128** 比特长度下的检索性能 。
    
3. **相关性判定：** 根据图像标签判定相关性（若两张图像具有至少一个相同标签，则视为相关）。
    
4. **性能评估：** 使用 mAP（Mean Average Precision）、Recall@K 曲线、Precision@K 曲线以及检索时间作为评价指标 。
    

---

## 2. 算法原理 (Methodology)

### 2.1 球面哈希 (Spherical Hashing)

不同于传统的基于超平面切分的哈希方法（如 LSH），球面哈希利用超球面（Hypersphere）来划分数据空间。

- **原理：** 算法通过迭代优化生成 $K$ 个超球面（其中 $K$ 为哈希比特数）。对于每一个数据点，根据其位于某个超球面的“内部”或“外部”，将其编码为 0 或 1。
    
- **训练目标：** 寻找一组球心（Pivots）和半径阈值（Thresholds），使得生成的二进制码满足平衡性（Balanced）和独立性（Independence）。
    
![[Pasted image 20251216213717.png]]



### 2.2 相似度度量与检索

- **汉明距离 (Hamming Distance)：** 检索阶段计算查询图像与数据库图像哈希码之间的汉明距离。汉明距离定义为两个等长二进制串中不同位的个数 。
    
- **检索流程：** 对每个查询图像，计算其与所有数据库图像的距离，并按距离由小到大排序，返回检索结果 。
    

### 2.3 评价指标公式

- mAP (Mean Average Precision)： 衡量检索排序质量的核心指标。计算公式如下 ：
    
    $$mAP=\frac{1}{N_{q}}\sum_{i=1}^{N_{q}}\{\frac{1}{N_{i}}\sum_{k=1}^{N}precision@k\cdot rel(i,k)\}$$
    
    其中 $rel(i,k)$ 表示第 $k$ 个结果是否相关，$N_i$ 为相关图像总数。
    

---

## 3. 实验设置 (Experimental Setup)

- **数据集划分：**
    
    - **Query Set (查询集)：** 前 1,000 张图像 。
        
    - **Database (数据库)：** 后 15,000 张图像 。
        
- **环境配置：**
    
    - 语言/工具：Python 3.9.13, NumPy, Matplotlib。
    - **操作系统**：Microsoft Windows 11 Home (Build 22000)
    - 硬件环境：CPU (Intel/AMD) / Lenovo Yoga
        
- **参数设置：**
    
    - 哈希位数 (Bits)：32, 64, 128。
        
    - 距离度量：Hamming Distance。
        

---

## 4. 实验结果 (Experimental Results)

### 4.1 检索性能汇总表
![[Pasted image 20251216212939.png]]

下表展示了不同比特数下的 mAP 值及平均检索时间：

| **Hash Bits** | **mAP** | **Average Retrieval Time (s/query)** |
| ------------- | ------- | ------------------------------------ |
| **32**        | 0.6375  | 0.00201                              |
| **64**        | 0.6616  | 0.00303                              |
| **128**       | 0.6763  | 0.00471                              |

### 4.2 性能曲线图

- **图 1：mAP 随比特数变化曲线** (`result_map_curve.png`)
- ![[Pasted image 20251216213126.png]]
    
    - _说明：展示了 mAP 随哈希码长度增加而上升的趋势。_
        
- **图 2：Precision@K 曲线** (`curve_precision.png`)
- ![[Pasted image 20251216213152.png]]
    
    - _说明：展示了前 K 个检索结果的查准率变化情况。_
        
- **图 3：Recall@K 曲线** (`curve_recall.png`)
    ![[Pasted image 20251216213235.png]]
    - _说明：展示了随着检索结果数量 K 的增加，查全率的上升趋势。_
        

---

## 5. 结果分析 (Analysis)

### 5.1 精度分析

从实验结果可以看出，随着哈希比特数从 32 增加到 128，mAP 值从 **0.6375** 提升到了 **0.6763**。

- **原因分析：** 哈希码长度的增加意味着特征空间的划分更加细致。更长的二进制串能够携带更多的原始图像语义信息，从而降低量化误差，使检索结果更准确。
    
### 5.2 效率分析

- **时间消耗：** 检索时间随比特数线性增长（从约 2ms 增加到 4.7ms），但整体仍保持在毫秒级。这得益于汉明距离计算的高效性（基于异或运算）。
    
- 存储消耗分析： 
    - 原始特征存储：$15000 \times 768 \times 4 \text{ Bytes (float32)} \approx 46 \text{ MB}$。
        
    - 32-bit 哈希存储：$15000 \times 32 \text{ bits} = 60 \text{ KB}$。
        
    - **结论：** 哈希算法将存储空间压缩了近 **700 倍**，极大地节省了内存。
        

---

## 6. 实验总结 (Conclusion)

本实验成功实现了基于球面哈希的图像检索系统。实验结果表明，球面哈希算法能够有效地将高维图像特征映射为紧凑的二进制码。虽然增加哈希位数会轻微增加检索时间，但能显著提升检索精度（mAP）。该方法在保证高精度的同时，极大地降低了存储成本和计算时间，适用于大规模图像检索场景。
